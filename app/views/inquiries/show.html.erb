
<div class="container">

  <div class="row">

    <div class="col-2 chatbox-cards"style="height: 100vh; overflow-y: scroll;">
      <% if @inquiries %>
        <% @inquiries.each do |inquiry| %>
          <%= link_to inquiry_path(inquiry), class: "text-decoration-none inquiry-box" do %>
            <div class="border-bottom mb-2 <%= inquiry.messages.last.user == current_user ? '' : 'border-danger' %> <%= inquiry == @inquiry ? 'border-success' : '' %> ">
              <p>#<%= inquiry.airplane.make %></p>
              <% if inquiry.user == current_user %>
                <p> <%= inquiry.airplane.user.nickname  %></p>
              <% else %>
                <p> <%= inquiry.user.nickname  %></p>
              <% end %>
              <% if inquiry.messages.last.user != current_user %>
              <p class="small danger">Awaiting your response</p>
              <% end %>
            </div>
          <% end %>
        <% end %>
      <% end %>
      <script>
        // Scroll to the bottom of the chatbox-cards div
        const chatboxCards = document.querySelector('.chatbox-cards');
        chatboxCards.scrollTop = chatboxCards.scrollHeight;
      </script>
    </div>

    <div class="row col-10 chat-box-container">

      <div class="col-6">
        <div class="container inquiry"
          data-controller="inquiry-subscription"
          data-inquiry-subscription-inquiry-id-value="<%= @inquiry.id %>"
        >
          <h2>#<%= @inquiry.airplane.make %></h2>

          <div class="messages-box" id="messages-box" data-inquiry-subscription-target="messages" style="height: 100vh; overflow-y: scroll;">
            <% @inquiry.messages.each do |message| %>
              <%= render "messages/message", message: message %>
            <% end %>

          </div>


          <%= simple_form_for [@inquiry, @message],
            html: { data: { action: "turbo:submit-end->inquiry-subscription#resetForm" }, class: "d-flex" }, id: "message-form" do |f|
          %>
            <%= f.input :content,
              label: false,
              placeholder: "Type here",
              wrapper_html: {class: "flex-grow-1"}
            %>
            <%= f.submit "Send", class: "btn btn-primary mb-3" %>

          <% end %>

        </div>
      </div>

      <div class="col-6">
        <% @airplane = @inquiry.airplane  %>
        <%=  cl_image_tag @airplane.photos.first.key, height: 400, width: 600, crop: :fill %>
        <p><%= @airplane.make %> <%= @airplane.engines %> <%= @airplane.tailnumber %> </p>
        <p><%= @airplane.user.nickname %></p>
        <%= link_to "View Plane", airplane_path(@airplane), class: "btn btn-dark mt-2 ms-5"%>
        <% if @inquiry.airplane.user == current_user && @inquiry.status == false %>
          <p> Has <%= @inquiry.user.nickname %> flown with you? </p>
          <%= simple_form_for [@inquiry] do |f| %>
              <%= f.input :status, collection: [false, true] %>
              <%= f.button :submit, class:"btn btn-dark"%>
            <% end %>
            </div>
          <% end %>
      </div>
    </div>
  </div>
  <script>
  var messagesBox = document.getElementById("messages-box");
  messagesBox.scrollTop = messagesBox.scrollHeight;
</script>
</div>
